(()=>{"use strict";function e(){var e,t;const o=null===(e=document.querySelector("meta[property='og:image']"))||void 0===e?void 0:e.getAttribute("content"),r=null===(t=document.querySelector("meta[property='og:description']"))||void 0===t?void 0:t.getAttribute("content"),s=document.URL;chrome.runtime.sendMessage({thumb:o,desc:r,url:s})}chrome.webNavigation.onHistoryStateUpdated.addListener((function(e){console.debug(`Setting actualPage to ${e.url}`),chrome.storage.local.set({actualPage:e.url}),chrome.storage.local.remove("videoUrl",(()=>console.debug("Removing video url")))}),{url:[{hostEquals:"twitter.com",pathContains:"status"}]}),chrome.webRequest.onBeforeRequest.addListener((function(t){chrome.tabs.query({active:!0,currentWindow:!0}).then((o=>{(function(e){var t;return!!e[0]&&Boolean(null===(t=e[0].url)||void 0===t?void 0:t.startsWith("https://twitter.com/home"))})(o)||chrome.storage.local.get({videoUrl:"notdefined"},(r=>{"notdefined"===r.videoUrl&&chrome.storage.local.set({videoUrl:t.url},(()=>{console.debug(`on callback set value for ${t.url}`),chrome.scripting.executeScript({target:{tabId:o[0].id},func:e})}))}))}))}),{urls:["https://video.twimg.com/*/*.m3u8*"]}),chrome.runtime.onMessage.addListener(((e,t,o)=>{if(!t.tab)return;console.debug("updating all infos for post... "+JSON.stringify(e));let{thumb:r,desc:s,url:n}=e;chrome.storage.local.get({posts:[],videoUrl:"notdefined"},(e=>{if(e.posts.some((e=>e.url===n)))return;let{videoUrl:t}=e;chrome.storage.local.set({posts:[...e.posts,{thumb:r,desc:s,url:n,videoUrl:t}]})}))})),chrome.runtime.onMessage.addListener(((e,t,o)=>{if(!t.tab)return"get-posts"===e&&chrome.storage.local.get("posts",(e=>{console.debug(`sending posts=${JSON.stringify(e.posts)}`),o(e.posts)})),!0}))})();